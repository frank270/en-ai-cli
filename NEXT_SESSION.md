# 下次開發 Session 起點

## 當前狀態

**版本**: v0.3.0  
**日期**: 2026-02-10  
**Git Commit**: eda58db  
**測試狀態**: ✅ 38/38 通過

## 已完成階段

- ✅ **Phase 1**: 基礎架構（配置、平台、API 客戶端）
- ✅ **Phase 2**: 核心對話功能（executor、session、history、chat）
- ✅ **Phase 3**: Session 管理與封存

## 下一步任務：實際 API 測試

### 目標

測試 En-Ai-Cli 與真實 OpenRouter API 的整合，驗證完整功能流程。

### 準備工作

1. **取得 API Key**
   - 前往 https://openrouter.ai/
   - 註冊並取得 API key（建議使用 free 模型降低成本）

2. **驗證環境**
   ```bash
   conda activate py39
   cd /Users/n/Projects/en-ai-cli
   pytest tests/ -v  # 確認所有測試通過
   ```

3. **初始化測試配置**
   ```bash
   en-ai init
   # 輸入 API Key
   # 選擇「優先使用 free 模型」選項
   ```

### 測試計畫

#### 階段 1：基本連線測試
- [ ] API Key 驗證成功
- [ ] 模型列表取得成功
- [ ] free 模型優先選擇

#### 階段 2：對話功能測試
- [ ] 簡單問答（如："Python 版本查詢指令是什麼？"）
- [ ] AI 回應顯示正常
- [ ] 歷史記錄存儲（檢查 `~/.en-ai/sessions/*.jsonl`）

#### 階段 3：指令建議與執行
- [ ] AI 建議指令（如："查看當前目錄的 Python 文件"）
- [ ] 指令確認提示顯示
- [ ] 指令執行與結果回饋
- [ ] 執行結果記錄到歷史

#### 階段 4：上下文管理
- [ ] 80% 警告觸發測試（需發送 40+ 則訊息）
- [ ] 警告提示顯示正確
- [ ] 封存功能正常
- [ ] 100% 上限處理（強制封存或清理）

#### 階段 5：Session 管理
- [ ] `session list` 顯示正確
- [ ] `session switch` 切換成功
- [ ] `session stats` 資訊準確
- [ ] `session export` Markdown 格式正確
- [ ] `session archive` 封存完整

### 測試問題範例

**簡單問答類**：
1. "什麼是 Python？"
2. "如何列出目錄內容？"
3. "Git 的基本指令有哪些？"

**指令建議類**：
1. "我想查看當前目錄下所有 Python 文件，該怎麼做？"
2. "如何檢查我的 Python 版本？"
3. "幫我創建一個名為 test.txt 的空文件"

**多輪對話類**：
1. "什麼是虛擬環境？"（第1輪）
2. "如何創建虛擬環境？"（第2輪）
3. "如何啟用它？"（第3輪）

### 預期測試時間

- 基本測試：10-15 分鐘
- 完整測試：30-45 分鐘
- 邊界測試：另外 15-20 分鐘

### 可能遇到的問題

1. **API Key 無效**
   - 檢查是否正確複製
   - 確認 OpenRouter 帳號狀態

2. **模型選擇失敗**
   - 檢查 free 模型可用性
   - 嘗試切換到其他 free 模型

3. **網路連線問題**
   - 確認網路暢通
   - 檢查防火牆設置

4. **上下文過長**
   - 測試封存功能
   - 驗證新 session 創建

### 除錯資訊收集

如遇問題，收集以下資訊：
- 錯誤訊息完整輸出
- `en-ai session stats` 輸出
- Session 歷史檔案：`~/.en-ai/sessions/<session_id>.jsonl`
- 當前配置：`en-ai config list`

### 成功標準

- ✅ 所有階段測試通過
- ✅ 無異常錯誤或崩潰
- ✅ 上下文管理按預期工作
- ✅ Session 管理功能完整

完成測試後，可進入 Phase 4（優化與擴展）或根據測試結果調整功能。

---

**重要提示**：測試時建議使用 free 模型，避免不必要的費用。OpenRouter 的 free 模型通常每日有請求限制，請注意控制測試頻率。
